# API чатов и сообщений
[Описание](#описание)\
[Структура проекта](#структура-проекта)\
[Запуск приложения (Docker Compose)](#запуск-приложения-docker-compose)\
[Примеры использования API](#примеры-использования-api)


## Описание
Проект представляет собой REST API для простого мессенджера, реализованного на языке Go (Golang).\
API позволяет управлять чатами и сообщениями: создавать чаты, отправлять сообщения, получать историю сообщений с ограничением по количеству, а также удалять чаты вместе со всеми связанными сообщениями.\
В качестве системы управления базами данных используется PostgreSQL, а для взаимодействия с БД — ORM GORM, применяемая исключительно для операций чтения и записи (структура таблиц задаётся через миграции).\
Проект полностью контейнеризирован и запускается с помощью Docker Compose, который управляет жизненным циклом всех сервисов:
### PostgreSQL
База данных поднимается на основе официального образа ```postgres:15```.
### Goose (миграции)
Отдельный сервис на базе образа ```golang:1.25```, который автоматически выполняет SQL-миграции при старте проекта.
Миграции создают необходимые таблицы и обеспечивают инициализацию схемы базы данных.
### Go-приложение
После успешного выполнения миграций происходит сборка и запуск основного сервиса.\
Сборка осуществляется через Dockerfile, при этом все тесты автоматически выполняются перед сборкой образа.\
HTTP-сервер реализован с использованием стандартной библиотеки net/http, без сторонних роутеров.\
Маршрутизация выполняется через кастомный mux, который:
* поддерживает REST-эндпоинты,
* валидирует входящие запросы,
* обеспечивает централизованную обработку ошибок,
* использует встроенный логгер slog для структурированного логирования HTTP-запросов и внутренних операций.
Архитектура проекта построена с разделением ответственности:
* handlers — обработка HTTP-запросов,
* repositories — работа с базой данных,
* models — доменные модели и структуры запросов,
* middlewares — логирование и дополнительные HTTP-обработчики.

## Структура проекта
```text
.
├── cmd
│   └── api
│       └── main.go
├── compose.yaml
├── Dockerfile
├── go.mod
├── go.sum
├── internal
│   └── pkg
│       ├── database
│       │   └── repository
│       │       ├── chat_repository.go
│       │       └── message_repository.go
│       ├── logger
│       │   └── logger.go
│       ├── model
│       │   ├── chat.go
│       │   ├── message.go
│       │   └── request.go
│       └── server
│           ├── create_chat_test.go
│           ├── handler.go
│           ├── middleware.go
│           └── mocks
│               └── chat_repository_mock.go
├── migrations
│   └── 20260113202726_add_tables.sql
└── README.md

12 directories, 17 files
```

## Запуск приложения (Docker Compose)
1. В корне проекта создайте файл .env со следующим содержимым:
``` dotenv
DATABASE_URL=postgresql://postgres:postgres@postgres:5432/postgres?sslmode=disable
```
2. В корне проекта выполните команду:
``` bash
docker compose up -d
```
## Примеры использования API
### Создать чат
URL: http://localhost:8080/chats/ \
Method: POST \
Body (формат JSON):
``` json
{
    "title":"your_title"
}
```
### Отправить сообщение в чат
URL: http://localhost:8080/chats/{id}/messages/ \
Method: POST \
Body (формат JSON):
``` json
{
    "text":"your_text"
}
```
### Получить чат и последние N сообщений
URL: http://localhost:8080/chats/{id} \
Method: GET \
Body (формат JSON):
``` json
{
    "limit": your_limit_between_1_and_100
}
```
### Удалить чат вместе со всеми сообщениями
URL: http://localhost:8080/chats/{id} \
Method: DELETE